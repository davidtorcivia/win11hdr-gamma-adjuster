<Window x:Class="HDRGammaController.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="HDR Gamma Controller - Settings"
        Width="520" Height="750"
        MinWidth="500" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E"
        Foreground="White"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResizeWithGrip">
    
    <Window.Resources>
        <!-- Accent Colors -->
        <SolidColorBrush x:Key="AccentBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="#1E90FF"/>
        <SolidColorBrush x:Key="CardBackground" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="CardBorder" Color="#3F3F3F"/>
        <SolidColorBrush x:Key="TextDim" Color="#888888"/>
        <SolidColorBrush x:Key="InputBackground" Color="#3D3D3D"/>
        <SolidColorBrush x:Key="DropdownBackground" Color="#2D2D2D"/>
        
        <!-- Dark ComboBox Toggle Button Template -->
        <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="20"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" Grid.ColumnSpan="2" 
                        Background="{StaticResource InputBackground}" 
                        BorderBrush="{StaticResource CardBorder}" 
                        BorderThickness="1" CornerRadius="4"/>
                <Path x:Name="Arrow" Grid.Column="1" 
                      Data="M 0 0 L 4 4 L 8 0 Z" 
                      Fill="White" 
                      HorizontalAlignment="Center" 
                      VerticalAlignment="Center"/>
            </Grid>
        </ControlTemplate>
        
        <!-- Dark ComboBox Template -->
        <Style TargetType="ComboBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton" 
                                          Template="{StaticResource ComboBoxToggleButton}" 
                                          Focusable="False" 
                                          ClickMode="Press"
                                          IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"/>
                            <ContentPresenter x:Name="ContentSite" 
                                              IsHitTestVisible="False" 
                                              Content="{TemplateBinding SelectionBoxItem}" 
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" 
                                              Margin="10,6,24,6" 
                                              VerticalAlignment="Center" 
                                              HorizontalAlignment="Left"/>
                            <Popup x:Name="Popup" 
                                   Placement="Bottom" 
                                   IsOpen="{TemplateBinding IsDropDownOpen}" 
                                   AllowsTransparency="True" 
                                   Focusable="False" 
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown" 
                                      SnapsToDevicePixels="True" 
                                      MinWidth="{TemplateBinding ActualWidth}" 
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder" 
                                            Background="{StaticResource DropdownBackground}" 
                                            BorderBrush="{StaticResource CardBorder}" 
                                            BorderThickness="1" CornerRadius="4"/>
                                    <ScrollViewer Margin="4" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Dark ComboBoxItem Style -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}" 
                                CornerRadius="4">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Dark TextBox Style -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>
        
        <!-- Styled Slider -->
        <Style x:Key="ModernSlider" TargetType="Slider">
            <Setter Property="Height" Value="24"/>
            <Setter Property="Margin" Value="0,4"/>
        </Style>
        
        <!-- Section Card Style -->
        <Style x:Key="SectionCard" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>
        
        <!-- Section Header -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>
        
        <!-- Label Style -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextDim}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,8,0,4"/>
        </Style>
        
        <!-- Value Display -->
        <Style x:Key="ValueDisplay" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
        </Style>
        
        <!-- Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentHoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Secondary Button -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#555"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Toggle Style -->
        <Style x:Key="ModernToggle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="0,4"/>
        </Style>
    </Window.Resources>

    <Border Background="#1E1E1E" BorderBrush="#3F3F3F" BorderThickness="1" CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="#252525" CornerRadius="8,8,0,0" MouseLeftButtonDown="TitleBar_MouseDown">
                <Grid Margin="16,0">
                    <TextBlock Text="Settings" VerticalAlignment="Center" FontWeight="Medium"/>
                    <Button Content="✕" HorizontalAlignment="Right" VerticalAlignment="Center"
                            Background="Transparent" Foreground="#888" BorderThickness="0"
                            FontSize="14" Padding="8,4" Cursor="Hand"
                            Click="Close_Click"/>
                </Grid>
            </Border>
            
            <!-- Main Content -->
            <Grid Grid.Row="1" Margin="20,12,20,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Monitor Selector Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,16">
                    <TextBlock Text="Monitor" Style="{StaticResource FieldLabel}" Margin="0,0,0,4"/>
                    <ComboBox x:Name="MonitorSelector" SelectionChanged="MonitorSelector_Changed"/>
                </StackPanel>
                
                <!-- Scrollable Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Hidden" Padding="0,0,4,0">
                    <StackPanel>
                        
                        <!-- Gamma Section -->
                        <Border Style="{StaticResource SectionCard}">
                            <StackPanel>
                                <TextBlock Text="Gamma" Style="{StaticResource SectionHeader}"/>
                                <ComboBox x:Name="GammaModeCombo" SelectionChanged="GammaModeCombo_Changed">
                                    <ComboBoxItem Content="Gamma 2.2" IsSelected="True"/>
                                    <ComboBoxItem Content="Gamma 2.4"/>
                                    <ComboBoxItem Content="Windows Default"/>
                                </ComboBox>
                            </StackPanel>
                        </Border>
                        
                        <!-- Brightness/Dimming Section -->
                        <Border Style="{StaticResource SectionCard}">
                            <StackPanel>
                                <Grid>
                                    <TextBlock Text="Brightness" Style="{StaticResource SectionHeader}"/>
                                    <TextBlock x:Name="BrightnessValue" Text="100%" Style="{StaticResource ValueDisplay}"/>
                                </Grid>
                                <Slider x:Name="BrightnessSlider" Style="{StaticResource ModernSlider}"
                                        Minimum="10" Maximum="100" Value="100" 
                                        ValueChanged="BrightnessSlider_ValueChanged"/>
                                <CheckBox x:Name="EnhanceShadowsCheck" Content="Enhance shadow detail (Recommended)" 
                                          ToolTip="When dimming, slightly lifts shadows to prevent them from becoming invisible (black crush)."
                                          Style="{StaticResource ModernToggle}" Margin="0,8,0,0"
                                          IsChecked="True" Checked="EnhanceShadows_Changed" Unchecked="EnhanceShadows_Changed"/>
                                
                                <!-- Quick Presets -->
                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                    <Button Content="100%" Style="{StaticResource ModernButton}" 
                                            Click="Brightness100_Click" Margin="0,0,8,0"/>
                                    <Button Content="75%" Style="{StaticResource ModernButton}" 
                                            Click="Brightness75_Click" Margin="0,0,8,0"/>
                                    <Button Content="50%" Style="{StaticResource ModernButton}" 
                                            Click="Brightness50_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Temperature/Tint Section -->
                        <Border Style="{StaticResource SectionCard}">
                            <StackPanel>
                                <TextBlock Text="Color Temperature" Style="{StaticResource SectionHeader}"/>
                                
                                <TextBlock Text="Temperature" Style="{StaticResource FieldLabel}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="TemperatureSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                            Minimum="-50" Maximum="50" Value="0"
                                            ValueChanged="TemperatureSlider_ValueChanged"/>
                                    <TextBlock x:Name="TemperatureValue" Grid.Column="1" Text="0" 
                                               Style="{StaticResource ValueDisplay}" Width="40"/>
                                </Grid>
                                <Grid>
                                    <TextBlock Text="Warm" Foreground="{StaticResource TextDim}" FontSize="10"/>
                                    <TextBlock Text="Cool" Foreground="{StaticResource TextDim}" FontSize="10" 
                                               HorizontalAlignment="Right"/>
                                </Grid>
                                
                                <TextBlock Text="Tint" Style="{StaticResource FieldLabel}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="TintSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                            Minimum="-50" Maximum="50" Value="0"
                                            ValueChanged="TintSlider_ValueChanged"/>
                                    <TextBlock x:Name="TintValue" Grid.Column="1" Text="0" 
                                               Style="{StaticResource ValueDisplay}" Width="40"/>
                                </Grid>
                                <Grid>
                                    <TextBlock Text="Green" Foreground="{StaticResource TextDim}" FontSize="10"/>
                                    <TextBlock Text="Magenta" Foreground="{StaticResource TextDim}" FontSize="10" 
                                               HorizontalAlignment="Right"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Night Mode Section -->
                        <Border Style="{StaticResource SectionCard}">
                            <StackPanel>
                                <TextBlock Text="Night Mode" Style="{StaticResource SectionHeader}"/>
                                <TextBlock Text="Quick toggle: Win+Shift+N • Applies to all HDR monitors" 
                                           Foreground="{StaticResource TextDim}" 
                                           FontSize="11" Margin="0,-8,0,8"/>
                                
                                <CheckBox x:Name="NightModeEnabled" Content="Enable scheduled night mode" 
                                          Style="{StaticResource ModernToggle}"
                                          Checked="NightModeEnabled_Changed" Unchecked="NightModeEnabled_Changed"/>
                                
                                <StackPanel x:Name="NightModeOptions" Margin="0,12,0,0">
                                    <!-- Auto Sunrise/Sunset Toggle -->
                                    <CheckBox x:Name="UseAutoSchedule" Content="Use sunrise/sunset times" 
                                              Style="{StaticResource ModernToggle}" Margin="0,0,0,8"
                                              Checked="UseAutoSchedule_Changed" Unchecked="UseAutoSchedule_Changed"/>
                                    
                                    <!-- Location (for auto mode) -->
                                    <StackPanel x:Name="LocationPanel" Margin="0,0,0,8">
                                        <TextBlock Text="Location (lat, lon)" Style="{StaticResource FieldLabel}"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox x:Name="LatitudeBox" Grid.Column="0" Margin="0,0,4,0" Text=""/>
                                            <TextBox x:Name="LongitudeBox" Grid.Column="1" Margin="4,0,4,0" Text=""/>
                                            <Button Grid.Column="2" Content="Detect" Style="{StaticResource SecondaryButton}"
                                                    Click="DetectLocation_Click" Padding="8,4"/>
                                        </Grid>
                                        <TextBlock x:Name="SunTimesDisplay" Text="" Foreground="{StaticResource TextDim}" 
                                                   FontSize="11" Margin="0,4,0,0"/>
                                    </StackPanel>
                                    
                                    <!-- Manual Times (when not auto) -->
                                    <StackPanel x:Name="ManualTimesPanel">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                <TextBlock Text="Start Time" Style="{StaticResource FieldLabel}"/>
                                                <TextBox x:Name="NightStartTime" Text="21:00"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                                <TextBlock Text="End Time" Style="{StaticResource FieldLabel}"/>
                                                <TextBox x:Name="NightEndTime" Text="07:00"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                    
                                    <!-- Algorithm Selector -->
                                    <TextBlock Text="Transformation Method" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox x:Name="NightAlgorithmCombo" Margin="0,0,0,12" SelectionChanged="NightAlgorithmCombo_Changed">
                                        <ComboBoxItem Content="Standard (Recommended)" ToolTip="Tanner Helland's algorithm. Provides a pleasant, warm, photo-realistic tint." IsSelected="True"/>
                                        <ComboBoxItem Content="Accurate (CIE 1931)" ToolTip="Physically accurate simulation of a black-body radiator. More scientifically precise."/>
                                        <ComboBoxItem Content="Blue Light Filter" ToolTip="Focuses specifically on reducing blue light (460nm range) for potential sleep benefits. May look less 'natural'."/>
                                    </ComboBox>

                                    <!-- Temperature in Kelvin -->
                                    <TextBlock Text="Night Temperature" Style="{StaticResource FieldLabel}"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider x:Name="NightTempSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                                Minimum="1900" Maximum="6500" Value="2700"
                                                ValueChanged="NightTempSlider_ValueChanged"/>
                                        <TextBlock x:Name="NightTempValue" Grid.Column="1" Text="2700K" 
                                                   Style="{StaticResource ValueDisplay}" Width="50"/>
                                    </Grid>
                                    <Grid Margin="0,2,0,0">
                                        <TextBlock Text="Warm (1900K)" Foreground="{StaticResource TextDim}" FontSize="10"/>
                                        <TextBlock Text="Daylight (6500K)" Foreground="{StaticResource TextDim}" FontSize="10" 
                                                   HorizontalAlignment="Right"/>
                                    </Grid>
                                    
                                    <!-- Fade Duration -->
                                    <TextBlock Text="Fade Duration (minutes)" Style="{StaticResource FieldLabel}"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider x:Name="FadeSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                                Minimum="0" Maximum="60" Value="30"
                                                ValueChanged="FadeSlider_ValueChanged"/>
                                        <TextBlock x:Name="FadeValue" Grid.Column="1" Text="30" 
                                                   Style="{StaticResource ValueDisplay}" Width="40"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- RGB Fine Tuning Section -->
                        <Border Style="{StaticResource SectionCard}">
                            <Expander Header="RGB Fine Tuning" Foreground="White" IsExpanded="False">
                                <StackPanel Margin="0,12,0,0">
                                    <!-- Red -->
                                    <TextBlock Text="Red Gain" Style="{StaticResource FieldLabel}"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider x:Name="RedGainSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                                Minimum="0.5" Maximum="1.5" Value="1.0" TickFrequency="0.01"
                                                ValueChanged="RgbSlider_ValueChanged"/>
                                        <TextBlock x:Name="RedGainValue" Grid.Column="1" Text="1.00" 
                                                   Style="{StaticResource ValueDisplay}" Width="40"/>
                                    </Grid>
                                    
                                    <!-- Green -->
                                    <TextBlock Text="Green Gain" Style="{StaticResource FieldLabel}"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider x:Name="GreenGainSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                                Minimum="0.5" Maximum="1.5" Value="1.0" TickFrequency="0.01"
                                                ValueChanged="RgbSlider_ValueChanged"/>
                                        <TextBlock x:Name="GreenGainValue" Grid.Column="1" Text="1.00" 
                                                   Style="{StaticResource ValueDisplay}" Width="40"/>
                                    </Grid>
                                    
                                    <!-- Blue -->
                                    <TextBlock Text="Blue Gain" Style="{StaticResource FieldLabel}"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider x:Name="BlueGainSlider" Grid.Column="0" Style="{StaticResource ModernSlider}"
                                                Minimum="0.5" Maximum="1.5" Value="1.0" TickFrequency="0.01"
                                                ValueChanged="RgbSlider_ValueChanged"/>
                                        <TextBlock x:Name="BlueGainValue" Grid.Column="1" Text="1.00" 
                                                   Style="{StaticResource ValueDisplay}" Width="40"/>
                                    </Grid>
                                    
                                    <Button Content="Reset RGB" Style="{StaticResource ModernButton}" 
                                            Click="ResetRgb_Click" Margin="0,12,0,0" HorizontalAlignment="Left"/>
                                </StackPanel>
                            </Expander>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
                
                <!-- Footer Buttons -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                    <CheckBox x:Name="LivePreviewToggle" Content="Live Preview" 
                              Foreground="White" VerticalAlignment="Center" Margin="0,0,16,0"
                              IsChecked="True" Checked="LivePreviewToggle_Changed" Unchecked="LivePreviewToggle_Changed"/>
                    <Button x:Name="ApplyButton" Content="Apply" Style="{StaticResource ModernButton}" 
                            Click="Apply_Click" Margin="0,0,8,0" Visibility="Collapsed"/>
                    <Button x:Name="CompareButton" Content="Compare (Hold)" Style="{StaticResource SecondaryButton}" 
                            PreviewMouseDown="Compare_MouseDown" PreviewMouseUp="Compare_MouseUp"
                            Margin="0,0,8,0"/>
                    <Button Content="Reset All" Style="{StaticResource SecondaryButton}" 
                            Click="ResetAll_Click" Margin="0,0,8,0"/>
                    <Button Content="Save &amp; Close" Style="{StaticResource ModernButton}" 
                            Click="SaveAndClose_Click"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>
